FROM alpine:latest

ENV CATALINA_HOME /usr/local/tomcat
ENV TOMCAT_VERSION 9.0.50
ENV TOMCAT_URL https://archive.apache.org/dist/tomcat/tomcat-9/v${TOMCAT_VERSION}/bin/apache-tomcat-${TOMCAT_VERSION}.tar.gz

RUN apk update \
    && apk add openjdk8 curl \
    && rm -rf /var/cache/apk/*

RUN wget ${TOMCAT_URL} -O /tmp/tomcat.tar.gz \
    && tar -zxvf /tmp/tomcat.tar.gz -C \
    &&  mv apache-tomcat-9.0.50 ${CATALINA_HOME} \
    &&  rm apache-tomcat-9.0.50.tar.gz


COPY tomcat-users.xml ${CATALINA_HOME}/conf/tomcat-users.xml
COPY context.xml ${CATALINA_HOME}/webapps/manager/META-INF/context.xml
COPY context.xml ${CATALINA_HOME}/webapps/host-manager/META-INF/context.xml

RUN mkdir ${CATALINA_HOME}/webapps/html-files \
    && COPY index.html ${CATALINA_HOME}/webapps/html-files/ \
    && COPY index.css ${CATALINA_HOME}/webapps/html-files/ \
    && COPY index.js ${CATALINA_HOME}/webapps/html-files/ \
    && COPY media/ ${CATALINA_HOME}/webapps/html-files/

EXPOSE 8080
CMD ["sh", "-c", "${CATALINA_HOME}/bin/catalina.sh run"]
