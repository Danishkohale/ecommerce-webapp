FROM alpine:latest

ENV CATALINA_HOME /usr/local/tomcat

RUN apk update \
    && apk add openjdk8 curl \
    && rm -rf /var/cache/apk/*

RUN mkdir -p /usr/local/tomcat \
    && curl -SL https://archive.apache.org/dist/tomcat/tomcat-9/v9.0.50/bin/apache-tomcat-9.0.50.tar.gz | tar -xz -C /usr/local/tomcat --strip-components=1 \
    && tar -zxvf apache-tomcat-9.0.50.tar.gz \
    && mv apache-tomcat-9.0.50 ${CATALINA_HOME} \
    && rm apache-tomcat-9.0.50.tar.gz

COPY tomcat-users.xml ${CATALINA_HOME}/conf/tomcat-users.xml
COPY context.xml ${CATALINA_HOME}/webapps/manager/META-INF/context.xml
COPY context.xml ${CATALINA_HOME}/webapps/host-manager/META-INF/context.xml

RUN mkdir ${CATALINA_HOME}/webapps/html-files \
    && COPY index.html ${CATALINA_HOME}/webapps/html-files/ \
    && COPY index.css ${CATALINA_HOME}/webapps/html-files/ \
    && COPY index.js ${CATALINA_HOME}/webapps/html-files/ \
    && COPY media/ ${CATALINA_HOME}/webapps/html-files/

EXPOSE 8080
CMD ["sh", "-c", "${CATALINA_HOME}/bin/catalina.sh run"]
